<!doctype html>
<html>
<head>
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="three.js/build/three.min.js"></script>

    <style>
        body{ background-color: ivory; }
        canvas{border:1px solid red;}
    </style>

    <script>
        $(document).ready(function(){
            var container = document.getElementById("container");

            var renderer = new THREE.WebGLRenderer({antialias:true});
            var camera = new THREE.PerspectiveCamera( 50, 841/594, 0.1, 10000);
            var scene = new THREE.Scene();

            scene.add(camera);
            renderer.setSize(841, 594);
            container.appendChild(renderer.domElement);

            /* Textures */
            THREE.crossOrigin = "";
            var bmap =  THREE.ImageUtils.loadTexture("https://s3-us-west-2.amazonaws.com/s.cdpn.io/33170/egyptian_friz_2.png", {}, function(){});
            var smap =  THREE.ImageUtils.loadTexture("https://s3-us-west-2.amazonaws.com/s.cdpn.io/33170/specular_map.jpg", {}, function(){});


            /* Camera Settings */
            camera.position.z = 600;
            camera.position.x = 15;
            camera.position.y = 15;
            camera.lookAt(new THREE.Vector3(0,0,0));

            /* Lightening */
            var light = new THREE.PointLight( new THREE.Color("rgb(255,70,3)"), 2.5);
            var light2 = new THREE.PointLight( new THREE.Color("rgb(255,15,255)"), 4);
            light.position.set( 0, -100, 1000 );
            light2.position.set( 50, 50, 1000 );



            /* Old Wall */
            var oldMaterial = new THREE.MeshPhongMaterial({
                color      :  new THREE.Color("rgb(155,196,30)"),
                emissive   :  new THREE.Color("rgb(7,3,5)"),
                specular   :  new THREE.Color("rgb(255,113,0)"),
                shininess  :  20,
                bumpMap    :  bmap,
                map        :  smap,
                bumpScale  :  0.45,
            });
            var oldWall = new THREE.Mesh( new THREE.PlaneGeometry(4000,400,32,8), oldMaterial );


            /* Scene */
            scene.add( oldWall );
            scene.add ( light );
            scene.add ( light2 );

            /* Updating Scene */
            var tmp = 0;
            function update() {
                camera.lookAt(new THREE.Vector3(1000*Math.sin(tmp),0,0));
                camera.position.x = 2000*Math.sin(tmp)/1.5;
                light.position.set(1000*Math.sin(tmp), 100*Math.sin(tmp), 500 );
                light2.position.set(1000*Math.sin(tmp), 100*Math.cos(tmp), 500 );
                tmp += 1/400;
            }

            /* Render */
            function render() {
                requestAnimationFrame( render );
                renderer.render( scene, camera );
                update();
            }

            render()





            var canvas=document.getElementById("canvas");
            var ctx=canvas.getContext("2d");
            var canvasOffset=$("#canvas").offset();
            var offsetX=canvasOffset.left;
            var offsetY=canvasOffset.top;
            var isDragging=false;

            var img1=new Image();
            var img=new Image();

            img.onload=function(){

                img1.onload=function(){
                    start(0, 0);
                }
                img1.src="imgs/sweater.png";
            }

            img.src="imgs/patterns.png";

            function start(offsetX, offsetY){

                ctx.drawImage(img1,0,0);

                ctx.globalCompositeOperation="source-atop";

                ctx.globalAlpha=.85;

                var pattern = ctx.createPattern(img, 'repeat');
                ctx.rect(0, 0, canvas.width, canvas.height);
                ctx.translate(offsetX, offsetY);
                ctx.fillStyle = pattern;
                ctx.fillRect(-offsetX, -offsetY, 600, 600);
                ctx.translate(-offsetX, -offsetY);

                ctx.globalAlpha=.15;
                ctx.drawImage(img1,0,0);
                ctx.drawImage(img1,0,0);
                ctx.drawImage(img1,0,0);

            }

            function handleMouseDown(e){
                canMouseX=parseInt(e.clientX-offsetX);
                canMouseY=parseInt(e.clientY-offsetY);
                isDragging=true;
            }

            function handleMouseUp(e){
                canMouseX=parseInt(e.clientX-offsetX);
                canMouseY=parseInt(e.clientY-offsetY);
                isDragging=false;
            }

            function handleMouseOut(e){
                canMouseX=parseInt(e.clientX-offsetX);
                canMouseY=parseInt(e.clientY-offsetY);
                isDragging=false;
            }

            function handleMouseMove(e){
                canMouseX=parseInt(e.clientX-offsetX);
                canMouseY=parseInt(e.clientY-offsetY);
                if(isDragging){
                    start(canMouseX-128/2, canMouseY-120/2);
                }
            }

            $("#canvas").mousedown(handleMouseDown);
            $("#canvas").mousemove(handleMouseMove);
            $("#canvas").mouseup(handleMouseUp);
            $("#canvas").mouseout(handleMouseOut);
        });
    </script>
</head>

<body>
<canvas id="canvas" width=600 height=600></canvas>
<div id="container"></div>
</body>
</html>